---
layout: default
navtitle: Subs-Db-mysql.php
title: ./Sources/Subs-Db-mysql.php
count: 22
---

### smf_db_initiate

```php
function smf_db_initiate($db_server, $db_name, $db_user, $db_passwd, $db_prefix, $db_options = array())
```
Maps the implementations in this file (smf_db_function_name)
 to the $smcFunc['db_function_name'] variable.



Type|Parameter|Description
---|---|---
```php string```|```php $db_server```|The database server
```php string```|```php $db_name```|The name of the database
```php string```|```php $db_user```|The database username
```php string```|```php $db_passwd```|The database password
```php string```|```php $db_prefix```|The table prefix
```php array```|```php $db_options```|An array of database options

### db_extend

```php
function db_extend($type = 'extra')
```
Extend the database functionality. It calls the respective file's init
to add the implementations in that file to $smcFunc array.



Type|Parameter|Description
---|---|---
```php string```|```php $type```|Indicates which additional file to load. ('extra', 'packages')

### db_fix_prefix

```php
function db_fix_prefix(&$db_prefix, $db_name)
```
Fix up the prefix so it doesn't require the database to be selected.



Type|Parameter|Description
---|---|---
```php string```|```php &$db_prefix```|The table prefix
```php string```|```php $db_name```|The database name

### smf_db_select

```php
function smf_db_select($database, $connection = null)
```
Wrap mysqli_select_db so the connection does not need to be specified



Type|Parameter|Description
---|---|---
```php string```|```php &$database```|The database
```php object```|```php $connection```|The connection object (if null, $db_connection is used)

### smf_db_get_server_info

```php
function smf_db_get_server_info($connection = null)
```
Wrap mysqli_get_server_info so the connection does not need to be specified



Type|Parameter|Description
---|---|---
```php object```|```php $connection```|The connection to use (if null, $db_connection is used)

### smf_db_replacement__callback

```php
function smf_db_replacement__callback($matches)
```
Callback for preg_replace_callback on the query.

It allows to replace on the fly a few pre-defined strings, for convenience ('query_see_board', 'query_wanna_see_board', etc), with
their current values from $user_info.
In addition, it performs checks and sanitization on the values sent to the database.

Type|Parameter|Description
---|---|---
```php array```|```php $matches```|The matches from preg_replace_callback

### smf_db_quote

```php
function smf_db_quote($db_string, $db_values, $connection = null)
```
Just like the db_query, escape and quote a string, but not executing the query.



Type|Parameter|Description
---|---|---
```php string```|```php $db_string```|The database string
```php array```|```php $db_values```|An array of values to be injected into the string
```php resource```|```php $connection```|= null The connection to use (null to use $db_connection)

### smf_db_query

```php
function smf_db_query($identifier, $db_string, $db_values = array(), $connection = null)
```
Do a query.  Takes care of errors too.



Type|Parameter|Description
---|---|---
```php string```|```php $identifier```|An identifier. Only used in Postgres when we need to do things differently...
```php string```|```php $db_string```|The database string
```php array```|```php $db_values```|= array() The values to be inserted into the string
```php resource```|```php $connection```|= null The connection to use (null to use $db_connection)

### smf_db_affected_rows

```php
function smf_db_affected_rows($connection = null)
```
affected_rows



Type|Parameter|Description
---|---|---
```php resource```|```php $connection```|A connection to use (if null, $db_connection is used)

### smf_db_insert_id

```php
function smf_db_insert_id($table, $field = null, $connection = null)
```
Gets the ID of the most recently inserted row.



Type|Parameter|Description
---|---|---
```php string```|```php $table```|The table (only used for Postgres)
```php string```|```php $field```|= null The specific field (not used here)
```php resource```|```php $connection```|= null The connection (if null, $db_connection is used)

### smf_db_transaction

```php
function smf_db_transaction($type = 'commit', $connection = null)
```
Do a transaction.



Type|Parameter|Description
---|---|---
```php string```|```php $type```|The step to perform (i.e. 'begin', 'commit', 'rollback')
```php resource```|```php $connection```|The connection to use (if null, $db_connection is used)

### smf_db_error

```php
function smf_db_error($db_string, $connection = null)
```
Database error!
Backtrace, log, try to fix.



Type|Parameter|Description
---|---|---
```php string```|```php $db_string```|The DB string
```php object```|```php $connection```|The connection to use (if null, $db_connection is used)

### smf_db_insert

```php
function smf_db_insert($method = 'replace', $table, $columns, $data, $keys, $returnmode = 0, $connection = null)
```
Inserts data into a table



Type|Parameter|Description
---|---|---
```php string```|```php $method```|The insert method - can be 'replace', 'ignore' or 'insert'
```php string```|```php $table```|The table we're inserting the data into
```php array```|```php $columns```|An array of the columns we're inserting the data into. Should contain 'column' => 'datatype' pairs
```php array```|```php $data```|The data to insert
```php array```|```php $keys```|The keys for the table, needs to be not empty on replace mode
```php int```|```php ```|returnmode 0 = nothing(default), 1 = last row id, 2 = all rows id as array
```php object```|```php $connection```|The connection to use (if null, $db_connection is used)

### smf_db_error_backtrace

```php
function smf_db_error_backtrace($error_message, $log_message = '', $error_type = false, $file = null, $line = null)
```
This function tries to work out additional error information from a back trace.



Type|Parameter|Description
---|---|---
```php string```|```php $error_message```|The error message
```php string```|```php $log_message```|The message to log
```php string&#124;bool```|```php $error_type```|What type of error this is
```php string```|```php $file```|The file the error occurred in
```php int```|```php $line```|What line of $file the code which generated the error is on

### smf_db_escape_wildcard_string

```php
function smf_db_escape_wildcard_string($string, $translate_human_wildcards = false)
```
Escape the LIKE wildcards so that they match the character and not the wildcard.



Type|Parameter|Description
---|---|---
```php string```|```php $string```|The string to escape
```php bool```|```php $translate_human_wildcards```|If true, turns human readable wildcards into SQL wildcards.

### smf_is_resource

```php
function smf_is_resource($result)
```
Validates whether the resource is a valid mysqli instance.

Mysqli uses objects rather than resource. https://bugs.php.net/bug.php?id=42797

Type|Parameter|Description
---|---|---
```php mixed```|```php $result```|The string to test

### smf_db_fetch_all

```php
function smf_db_fetch_all($request)
```
Fetches all rows from a result as an array



Type|Parameter|Description
---|---|---
```php resource```|```php $request```|A MySQL result resource

### smf_db_error_insert

```php
function smf_db_error_insert($error_array)
```
Function to save errors in database in a safe way



Type|Parameter|Description
---|---|---
```php array```|```php ```|with keys in this order id_member, log_time, ip, url, message, session, error_type, file, line

### smf_db_custom_order

```php
function smf_db_custom_order($field, $array_values, $desc = false)
```
Function which constructs an optimize custom order string
as an improved alternative to find_in_set()



Type|Parameter|Description
---|---|---
```php string```|```php $field```|name
```php array```|```php $array_values```|Field values sequenced in array via order priority. Must cast to int.
```php bool```|```php $desc```|default false

### smf_db_native_replace

```php
function smf_db_native_replace()
```
Function which return the information if the database supports native replace inserts



### smf_db_cte_support

```php
function smf_db_cte_support()
```
Function which return the information if the database supports cte with recursive



### smf_db_escape_string

```php
function smf_db_escape_string($string, $connection = null)
```
Function which return the escaped string



Type|Parameter|Description
---|---|---
```php string```|```php ```|the unescaped text
```php resource```|```php $connection```|= null The connection to use (null to use $db_connection)

